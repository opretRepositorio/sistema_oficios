@model SolicitudRestablecimientoViewModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Recuperar contraseña";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"] - OfiGest</title>
    <meta http-equiv="Cache-Control" content="no-store" />


    <!-- Estilos institucionales -->
   
   
</head>

<body>
    <div class="main-container">
        <div class="card card-login">
            <div class="card-body text-center">
                <form asp-action="SolicitarRestablecimiento" method="post" class="d-grid gap-1" autocomplete="on">
                    @Html.AntiForgeryToken()

                    <h1 class="titulo-app mb-0">OfiGest</h1>
                    <h5 class="subtitulo-app text-muted">Recuperación de cuenta institucional</h5>

                    @if (TempData["RestablecimientoExitoso"] != null)
                    {
                        <div class="alert alert-success text-center mt-3">
                            <i class="bi bi-check-circle-fill me-2"></i> @TempData["RestablecimientoExitoso"]
                        </div>
                    }

                    <div class="form-group mt-3">
                        <i class="bi bi-envelope"></i>
                        <input asp-for="Correo" class="form-control" id="Correo" name="Correo" placeholder="Correo institucional" autocomplete="username" />
                        <span asp-validation-for="Correo" class="text-danger"></span>
                    </div>

                    <button type="submit" class="btn btn-login d-flex justify-content-center align-items-center gap-2 mt-3">
                        <span>Enviar enlace de recuperación</span>
                        <div class="progress-container">
                            <div class="progress-bar custom-progress"></div>
                        </div>
                    </button>

                    <a asp-action="Index" asp-controller="Login" class="link-recuperar mt-2">Volver al inicio de sesión</a>
                </form>
            </div>
        </div>
    </div>

    <div class="footer-bar"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.querySelector('form');
            const correoInput = document.getElementById('Correo');
            const btnLogin = document.querySelector('.btn-login');
            const progressBar = document.querySelector('.progress-bar');
            const mensajeExito = document.querySelector('.alert-success');
            const mensajeError = document.querySelector('.alert-danger');

            // Función para eliminar espacios extras
            function limpiarEspacios(texto) {
                return texto.replace(/\s+/g, '').trim(); // Elimina todos los espacios
            }

            // Limpiar espacios en el input de Correo
            if (correoInput) {
                correoInput.addEventListener('input', function () {
                    let valor = this.value;
                    let valorLimpio = limpiarEspacios(valor);

                    if (valor !== valorLimpio) {
                        this.value = valorLimpio;
                    }
                });

                correoInput.addEventListener('blur', function () {
                    this.value = limpiarEspacios(this.value);
                });
            }

            form?.addEventListener('submit', function (e) {
                // Limpiar espacios finales antes de enviar
                if (correoInput) {
                    correoInput.value = limpiarEspacios(correoInput.value);
                }

                btnLogin.disabled = true;
                btnLogin.querySelector('span').textContent = 'Enviando enlace...';
                simularProgreso();
            });

            function simularProgreso() {
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 5;
                    progressBar.style.width = progress + '%';
                    if (progress >= 100) clearInterval(interval);
                }, 150);
            }

            [mensajeExito, mensajeError].forEach(msg => {
                if (msg) {
                    setTimeout(() => {
                        msg.classList.add("fade-out");
                        setTimeout(() => {
                            if (msg.parentNode) msg.remove();
                        }, 500);
                    }, 5000);
                }
            });
        });
    </script>
</body>
</html>
